
gateway:
  enabled: true
  name: media-stack-gateway
  className: cilium
  annotations:
    cert-manager.io/cluster-issuer: openbao-issuer

  # TLS template anchor
  tls-template: &tls
    mode: Terminate
    certificateRefs:
      - kind: Secret

  listeners:
    - name: prowlarr-https
      protocol: HTTPS
      port: 443
      hostname: prowlarr.homelab.lan
      tls:
        <<: *tls
        certificateRefs:
          - kind: Secret
            name: prowlarr-tls

    - name: sonarr-https
      protocol: HTTPS
      port: 443
      hostname: sonarr.homelab.lan
      tls:
        <<: *tls
        certificateRefs:
          - kind: Secret
            name: sonarr-tls

    - name: radarr-https
      protocol: HTTPS
      port: 443
      hostname: radarr.homelab.lan
      tls:
        <<: *tls
        certificateRefs:
          - kind: Secret
            name: radarr-tls

    - name: jellyfin-https
      protocol: HTTPS
      port: 443
      hostname: jellyfin.homelab.lan
      tls:
        <<: *tls
        certificateRefs:
          - kind: Secret
            name: jellyfin-tls

httpRoutes:
  enabled: true

  # Common parentRef anchor
  parent-ref: &parent-ref
    - name: media-stack-gateway

  # Common rule template anchor
  rule-template: &rule-template
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs: []

  items:
    - name: prowlarr
      parentRefs: *parent-ref
      hostnames:
        - prowlarr.homelab.lan
      rules:
        - <<: *rule-template
          backendRefs:
            - name: media-stack-prowlarr
              port: 9696

    - name: sonarr
      parentRefs: *parent-ref
      hostnames:
        - sonarr.homelab.lan
      rules:
        - <<: *rule-template
          backendRefs:
            - name: media-stack-sonarr
              port: 8989

    - name: radarr
      parentRefs: *parent-ref
      hostnames:
        - radarr.homelab.lan
      rules:
        - <<: *rule-template
          backendRefs:
            - name: media-stack-radarr
              port: 7878

    - name: jellyfin
      parentRefs: *parent-ref
      hostnames:
        - jellyfin.homelab.lan
      rules:
        - <<: *rule-template
          backendRefs:
            - name: media-stack-jellyfin
              port: 8096

# Base deployment config
.deployment-config: &config
  persistentVolumeClaims: null
  ingress:
    enabled: false
  secrets:
    - name: "apiKey"
      value: "testingKey1234567890"

# Common emptyDir template
.emptyDir-500Mi: &emptyDir-500Mi
  emptyDir:
    sizeLimit: 500Mi

# Application-specific configs
prowlarr:
  <<: *config
  deployment:
    volumes:
      config:
        <<: *emptyDir-500Mi
        persistentVolumeClaim: null

sonarr:
  <<: *config
  deployment:
    volumes:
      config:
        <<: *emptyDir-500Mi
        persistentVolumeClaim: null
      downloads:
        <<: *emptyDir-500Mi
      tv:
        <<: *emptyDir-500Mi

radarr:
  <<: *config
  deployment:
    volumes:
      config:
        <<: *emptyDir-500Mi
        persistentVolumeClaim: null
      downloads:
        <<: *emptyDir-500Mi
      film:
        <<: *emptyDir-500Mi

jellyfin:
  <<: *config
  deployment:
    container:
      volumeMounts:
        - name: "config"
          mountPath: "/config"
        - name: "film"
          mountPath: "/film"
        - name: "television"
          mountPath: "/tv"
    volumes:
      config:
        <<: *emptyDir-500Mi
        persistentVolumeClaim: null
      film:
        <<: *emptyDir-500Mi
      television:
        <<: *emptyDir-500Mi